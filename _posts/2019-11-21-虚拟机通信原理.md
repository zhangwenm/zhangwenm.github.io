---
layout: post
title: 虚拟机网卡原理
date: 2019-11-21
tags: [虚拟机,虚拟网卡,TUN/TAP,CHAR DEV]
---

虚拟机以及虚拟网卡
----

###### 虚拟机

在数据中心里，虚拟机是由虚拟化软件通过qemu-kvm技术在物理机器上模拟出来的一个虚拟机器。emu即为Emulator（模拟器）的意思，主要模拟的是cpu，内存，网络，硬盘。使虚拟机感觉自己在独立的设备，其实还是使用的物理级的设备。虚拟机软件向上使虚拟机上的软件感觉在独享资源。向下从物理级上的到资源。

###### 虚拟网卡
虚拟机通过虚拟网卡与物理级进行通信。在qemu-kvm中，虚拟网卡是通过linux中一种TUN/TAP技术来实现的。虚拟机其实是跑在物理机器上的一个虚拟软件，它能像其他软件一样打开文件一样打开一个CHAR DEV（字符设备文件），当打开这个文件后，就会在物理机上形成一个虚拟TAP网卡。这样虚拟机就会觉得自己真有一张网卡，网络包会往这个网卡发。发送的网络包会转换成流写进字符设备文件。内核中的TUN/TAP字符设备驱动会收到这个字符流，并将字符流交给TUN/TAP虚拟网网卡驱动，这个驱动再次将字节流转换成网络包转发给TCP/IP协议栈，最终从虚拟网卡发出成为标准的网络包。

